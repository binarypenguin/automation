---
- name: Ensure packages are installed
  apt: pkg={{item}} state=latest update_cache=yes
  with_items:
  - nginx  

- name: Create nginx root directory
  file: path=/srv/nginx state=directory mode=0755 owner=root group=root


- name: Setup systemwide pages
  include: system.yml

- name: Create Team Group
  group: name="www-{{item.name}}"
  with_items: teams
  when: teams is defined

- name: Create Team System Account
  user: name="www-{{item.name}}" group="www-{{item.name}}" system=yes append=yes
  with_items: teams
  when: teams is defined

- name: Create Team Virtual Directories
  file:
    path: "{{nginx_www_dir}}/{{item.0.name}}/{{item.1.domainname}}"
    state: directory
    owner: "www-{{item.0.name}}"
    group: "www-{{item.0.name}}"
    mode: 0755
  with_subelements:
    - teams
    - sites
  when: teams is defined
